EUROGRAPHICS 2007 / D. Cohen-Or and P. Slavík (Guest Editors)

Volume 26 (2007), Number 3

QuadCover - Surface Parameterization using Branched Coverings
Felix Kälberer† Matthias Nieser†
Freie Universität Berlin

Konrad Polthier†

Abstract We introduce an algorithm for the automatic computation of global parameterizations on arbitrary simplicial 2manifolds, whose parameter lines are guided by a given frame ﬁeld, for example, by principal curvature frames. The parameter lines are globally continuous and allow a remeshing of the surface into quadrilaterals. The algorithm converts a given frame ﬁeld into a single vector ﬁeld on a branched covering of the 2-manifold and generates an integrable vector ﬁeld by a Hodge decomposition on the covering space. Except for an optional smoothing and alignment of the initial frame ﬁeld, the algorithm is fully automatic and generates high quality quadrilateral meshes. Categories and Subject Descriptors (according to ACM CCS): I.3.5 [Computer Graphics]: Computational Geometry and Object Modeling, Hierarchy and geometric transformations, Geometric algorithms, languages, and systems

1. Introduction The idea of local charts belongs to the most fruitful concepts in the differential geometry of smooth manifolds. Originally invented by Riemann, each manifold is locally considered as a distorted Euclidean space where charts provide the mathematical formalism to describe the relation, the deformation and the differences to Euclidean space. For example, charts on surfaces immediately provide a local coordinate system which allows to transfer differential operators onto curved surfaces. The ﬁeld of geometry processing investigates meshes, simplicial surfaces where no a priori parameterization is given. In order to reach a differential framework, beyond the purely topological point of view, the ﬁeld of discrete differential geometry was invented. For the ﬁrst time it was then possible to transfer differential operators onto simplicial surfaces and to work in a similar way like on smooth surfaces. But considering the strong similarities between image and geometry processing, we still encounter many algorithms invented in image processing which do not have counterparts
† Supported by the DFG Research Center M ATHEON ”Mathematics for key technologies” and mental images GmbH.
c The Eurographics Association and Blackwell Publishing 2007. Published by Blackwell Publishing, 9600 Garsington Road, Oxford OX4 2DQ, UK and 350 Main Street, Malden, MA 02148, USA.

Figure 1: QuadCover generates high quality parameter lines on simplicial surfaces. The automatic parameterization is guided by a user-given frame ﬁeld, such as principal curvature directions, and is well suited for regular quadrilateral remeshing.

Kälberer, Nieser, Polthier / QuadCover - Surface Parameterization using Branched Coverings

in the ﬁeld of geometry processing yet. For example, the efﬁcient wavelet theory on images essentially requires a 2dimensional coordinate system which has not been available on general simplicial surfaces yet. In fact, having natural coordinates on a simplicial surface would pave the way for transferring and adjusting many algorithms onto surfaces. The present work focuses on the automatic construction of a global surface parameterization. The parameterization is guided by a user-deﬁned frame ﬁeld, for example, by a ﬁeld of principal curvature directions, or by any other frame ﬁeld arising in applications. This paper is driven by a conceptual clarity of the underlying algorithm. Starting from a given frame ﬁeld, the algorithm ﬁrst constructs a locally integrable ﬁeld, and then a globally integrable ﬁeld taking the topology of the underlying surface into account. The issue of branch points of the frame ﬁeld is resolved by branched covering spaces on which the given frame ﬁeld naturally simpliﬁes to a single vector ﬁeld where standard Hodge decomposition techniques are used to assure global integrability. The paper has close contact to the fundamental paper of Ray, Lee, Levy, Sheffer, and Alliez [RLL∗ 06] and extends their initial ideas to a more general and automatic framework. Finally, given a global parameterization on any simplicial surface we will see a wealth of future applications. From texture mapping to extension of image processing algorithms, from remeshing to the automatic construction of hierarchical subdivision surfaces, all applications using natural coordinates will beneﬁt from the added structure of a global parameterization. 1.1. Previous work The research area of surface parameterization has a long and fruitful tradition. There already exists a wealth of different previous approaches to surface parameterization and, more general, the generation of quad and quad dominant meshes from given triangle meshes. One of the ﬁrst impressive works is by Gu and Yau [GY03] who construct global conformal parameterizations of surfaces with arbitrary genus. The resulting parameter lines minimize angle distortion but may have a rather large metric distortion. Furthermore, the space of global conformal parameterizations is too rigid to allow a local alignment of the parameter lines at given surface features. The method of Boier-Martin, Rushmeier, and Jin [BMRJ04] clusters the surface into macropatches and parameterizes each surface patch. Kharevych, Springborn, and Schröder [KSS06] ﬁnd a conformal parameterization via circle patterns. In contrast to Gu and Yau, they use conesingularities to increase the ﬂexibility of purely conformal mappings. Dong et al. [DBG∗ 06] compute the Morse-Smale complex of eigenfunctions of the mesh Laplacian to com-

pute a patch layout. The nodes of the complex are then utilized similarly to the cone singularities in [KSS06]. Early approaches for quadrangular remeshing guided by principal curvature directions are from Alliez et al. [ACSD∗ 03]. They were extended by Marinov and Kobbelt [MK04], and base on the integration of curvature lines on the surface. Dong, Kircher, and Garland [DKG05] presented an algorithm which traces isolines in two conjugate harmonic vector ﬁelds. Marinov and Kobbelt focus on creating coarse quad-dominant meshes in [MK06] by approximating the surface with very few patches, which are then individually subdivided into quads. Tong, Alliez, Cohen-Steiner, and Desbrun [TACSD06] use harmonic one-forms for surface parameterization. They enlarge the space of harmonic one-forms by allowing additional singular points on the surface. The extended cut graph increases the homology group and thus the space of harmonic one-forms on the surface. As a consequence, the user-deﬁned choice of placing the singular points and the cut graph allows a controlled modeling of the harmonic oneforms. Still, the approach is constrained by the global nature of harmonic one-forms, in some sense, similar to the algorithm of Gu and Yau [GY03]. Ray et al. [RLL∗ 06] parameterize surfaces of arbitrary genus with periodic potential functions guided by two orthogonal input vector ﬁelds. This leads to a continuous parameterization except in the vicinity of singular points on the surface. These singular regions are detected and reparameterized afterwards. Our approach was strongly inspired by their work. 1.2. Contributions We derive an algorithm to compute a global continuous parameterization for an arbitrary given simplicial 2-manifold. The algorithm runs automatically and the parameter lines align optimally with a user-deﬁned frame ﬁeld, for example, the principal curvature directions. We introduce a theoretical framework for frame ﬁelds on surfaces and their relation to branched covering spaces of the surface. As a consequence, frame ﬁelds on the surface simplify to vector ﬁelds on the covering space, so that the problem of parameterizing with frame ﬁelds reduces to the problem of ﬁnding a proper integrable vector ﬁeld on the covering surface. The branch points of our covering space lie at the branch points of the given frame ﬁeld. They are conceptually similar to the singular points with fractional index used by [TACSD06] and [RVLL06]. Instead of restricting ourselves to harmonic frame ﬁelds, we allow an additional divergence part and seek the optimal parameterization in the larger space of locally integrable frame ﬁelds, enabling the parameter lines to better align with the given input ﬁeld.
c The Eurographics Association and Blackwell Publishing 2007.

Kälberer, Nieser, Polthier / QuadCover - Surface Parameterization using Branched Coverings

face. Thus, the Jacobians of the charts are related by Dϕi (p) = J ri j Dϕ j (p), J := 0 −1 1 , p ∈ Ui ∩U j (1) 0

with a constant integer ri j ∈ {0, 1, 2, 3} on the intersection Ωi ∩ Ω j . We call the values ri j matchings between charts Ui and U j . See Figure 3 for nontrivial matchings. Second, the parameter values may differ only by integer values in the u and v coordinate, since the unit grid is invariant under translations by integer values. a) b) The transition functions ϕ j ◦ ϕ−1 of a parameterization i fulﬁlling the two conditions above are automorphisms of the unit grid. We call a linear function f : R2 → R2 which meets f (z) = J r z + t, a grid automorphism. Uj Ui U0 ϕi U2 U1 r ∈ Z, t ∈ Z2 , z ∈ R2 (2)

c)

d)

Ω2 Ω0 Ω1

Figure 2: A perfectly regular knot (a) was irregularly retriangulated and disturbed by noise (b). Our parameterization of the noisy model (c) provides a stable reconstruction (d). 2. Setting We construct a parameterization of a 2-manifold, whose parameter lines divide the surface into quads. Akin to earlier quad-dominant remeshing algorithms [ACSD∗ 03, RLL∗ 06], a major aim of our method is to construct parameter lines which are close to the principal curvature directions. In this section we will introduce the underlying concepts. 2.1. Matchings Smooth setting. Given a smooth 2-manifold M with charts ϕi : Ui ⊂ M → Ωi ⊂ R2 . The parameter grid on M is the preimage under ϕi of the unit grid lines Z × R and R × Z. A local parameterization can be easily deﬁned in each chart by taking arbitrary map ϕi ; the non-trivial task is to assure global continuity of the parameter lines on the surface. A globally continuous parameterization consists of a set of charts {Ui , ϕi } for which the parameter lines coincide in all regions where two charts Ui , U j overlap. The transition functions between adjacent charts of a global parameterization satisfy two conditions, see also [RLL∗ 06]: First, the gradients of the parameterization functions have to agree up to a rotation by multiples of π , because u- and 2 v-lines should not be distinguished on the parameterized surc The Eurographics Association and Blackwell Publishing 2007.

Figure 3: Parameterization of two overlapping charts with a matching of ri j = 3 (left), and of a cube with matchings r01 = r12 = 0, r20 = 1 (right). Discretization. Just as [RLL∗ 06], we consider each triangle as a chart on discrete triangle meshes. The transition function between two adjacent triangles is fully determined by the matching and the translation vector associated to their common edge. The methods of [TACSD06] and [DBG∗ 06] divide the surface into large scale quadrilateral patches. The patches are used as charts and allow non-trivial matchings only at patch boundaries. In contrast, triangle based charts allow to choose matchings independently at every edge and permit much more ﬂexible topological structures of parameter lines. 2.2. Branched covering spaces First, recall some deﬁnitions about Riemann surfaces, see [FK80], [Ful95], [Jos02]. Deﬁnition 1 Let M be a Riemann surface. A (branched) covering M ′ of M is a Riemann surface with a local homeomorphism π : M ′ → M, where for each p′ ∈ M ′ there exists a neighborhood U ′ ∋ p′ with local coordinates z′ : U ′ → C, z′ (p′ ) = 0 and a neighborhood U ∋ π(p′ ) with local coordinates z : U → C, z(π(p′ )) = 0 and an integer n p > 0, such that π is given by z = (z′ )n p in terms of local coordinates.

Kälberer, Nieser, Polthier / QuadCover - Surface Parameterization using Branched Coverings

If n p > 1, then p is called a branch point of M ′ . The number n p is usually referred to as the ramiﬁcation index of the point p. If p ∈ M is no branch point, then there exists a neighborhood V of p such that every connected component of π−1 (V ) is mapped by π homeomorphically onto V . Deﬁnition 2 A trivial covering of a connected set U ⊂ M is a covering U ′ where every connected component of π−1 (U) is mapped by π homeomorphically onto U. The components π−1 (U) of a trivial covering are called layers. They will be denoted by U l ⊂ U ′ , l ∈ {0, . . . , #layers − l 1}. Let τU = (π|U l )−1 : U → U l be the inverse of the projection operator in the given layer l. Here we consider coverings whose metric is induced from the surface M by π−1. Thus, an n-sheeted trivial covering of M can be seen as just n copies of M, cf. Figure 5, top left. One way of constructing a covering on M is to take coverings of its charts and glue them together at their intersection: For each two charts Ui , U j of M with Ui ∩ U j = ∅, let ρ : π−1 (Ui ∩ U j ) → π−1 (Ui ∩ U j ) be an isomorphism bei j tween trivial coverings of the charts. The patches can then be merged together by identifying the corresponding points of the two coverings, cf. Figure 5, top right. The following construction shows, how the matchings ri j of a manifold M canonically induce a covering of M. We restrict to 4-sheeted coverings as they naturally appear in the study of frame ﬁelds. Deﬁnition 3 Let be 4-sheeted trivial coverings of the charts Ui . For two overlapping charts Ui , U j , the map ρ : π−1 (Ui ∩ U j ) → π−1 (Ui ∩ U j ), which maps a point p ∈ i j
l ◦ πU (p) into layer τUi (Ui ∩ U j ) from layer l to τU ji j (ri j + l)mod 4, is an isomorphism. Thus, by identifying the two layers with ρ, the trivial coverings of the charts can be glued together (Figure 5, top right). We call the resulting covering M ′ of the covering induced by r. (r +l)mod 4

Figure 4: A set of four vectors given in each point which cannot be described with global vector ﬁelds. Left: On a ﬂat torus an integral line meets itself perpendicularly. Right: Around the vertex of a cube exists no match of vectors. shift around v is then given by:
n

ls(v) :=

i=0

∑ ri,i+1

mod 4

(3)

2.3. Frame ﬁelds We now introduce globally deﬁned frame ﬁelds, which are the guiding geometric structure for our parameterizations. Deﬁnition 5 Given a manifold M with charts Ui and matchings r. A frame ﬁeld on M is a collection of four vector ﬁelds Xi,0 , Xi,1 , Xi,2 , Xi,3 , in each chart Ui which satisfy in all overlapping charts Ui ∩U j : X j,k = Xi,(k−ri j ) mod 4 , k ∈ {0, 1, 2, 3}. This means that the vectors X j,k are cyclically permuted to Xi,k by a shift of −ri j . If Xi,2 = −Xi,0 , Xi,3 = −Xi,1 in all domains Ωi , the frame ﬁeld is called symmetric. In the example of Figure 3 (left), Xi,1 coincides with X j,0 , corresponding to ri j = 3. Fig. 4 shows examples of a frame ﬁeld on a ﬂat torus and a cube, which cannot be expressed in terms of 4 global vector ﬁelds. Remark. The direction ﬁelds introduced in [RVLL06] are a special kind of frame ﬁelds, which require the vectors Xi,0 and Xi,1 to be perpendicular, and to have unit length. These ﬁelds may have single points with a fractional index. In our notion, singular points with fractional index n/4 can only occur at branch points of the covering with layer shift n mod 4. The integer part of the index is determined by the vector ﬁeld index on the covering. A global parameterization ϕ can be represented in differential form by a global frame ﬁeld on M using the following two vector ﬁelds in each chart Ui : Xi,0 := (Dϕi )−1 (e1 ),
2

(Ui′ , πi )

The covering M induced by the matchings has no branch points. To enlarge the space of possible frame ﬁelds on the manifold, the covering surface may possess single points p ∈ M, whose covering locally looks like z → zn , n ∈ Z. For these points, there is no neighborhood U, for which π−1 (U) is manifold (see Figure 5, bottom right). Discretization. In the discrete setting, branch points are located at vertices. On a 4-sheeted covering they occur when the (oriented) sum of all matchings of outgoing edges differs from 0 (modulo 4). This means starting somewhere in the neighborhood of v and walking around the vertex, ends on a different layer in the covering than the start point. The following notion is used for describing different types of branch points. Deﬁnition 4 Let v be a vertex of M, T0 , . . . , Tn−1 the triangles incident to v in counterclockwise order, Tn = T0 and ri,i+1 the matching at the edge between adjacent triangles. The layer

′

Xi,1 := (Dϕi )−1 (e2 )

(4)

with the unit vectors e1 , e2 in R . With e3 := −e1 , e4 := −e2 and Xi,2 := (Dϕi )−1 (e3 ), Xi,3 := (Dϕi )−1 (e4 ), we obtain indeed a frame ﬁeld: for k ∈ {0, 1, 2, 3} X j,k = (Dϕ j )−1 (ek ) = (D(J ri j ϕi ))−1 (ek ) = (Dϕi )−1 (J −ri j ek ) = Xi,(k−ri j ) mod 4 (5)

c The Eurographics Association and Blackwell Publishing 2007.

Kälberer, Nieser, Polthier / QuadCover - Surface Parameterization using Branched Coverings

U0 U1
0 τU 1 τU

πU

πU

πV Figure 6: Isolines of a symmetric scalar function at a branch point with layer shift 1 (left), 2 (middle), 3 (right). 2.5. Scalar functions on covering spaces Parameterization functions are scalar functions on the covering, which may be discontinuous: along the common edge of two adjacent triangles the function may differ by a constant value. Deﬁnition 8 Given a surface M with matching r. Let G be a cut graph of M, i. e., a set of edges in M, such that M \ G is a topological disk. We deﬁne the function space

U

U

V

πU

πV

U

V

ˆ Sr (M ′ ) := {piecewise linear functions on M ′ which are continuous except at G} ˆ A function f ∈ Sr (M ′ ) is called a symmetric covering function, if for all charts U of M and p ∈ U, the values of f in the preimages π−1 (p) satisfy:
0 2 f (τU (p)) = − f (τU (p)), 3 1 f (τU (p)) = − f (τU (p)).

Figure 5: Top left: Trivial covering. Top right: Patching two coverings together. Bottom left: A frame ﬁeld lifted to a vector ﬁeld on the covering. Bottom right: Branch point.

Discretization. The frame ﬁelds are discretized to be constant on each triangle. For symmetric frame ﬁelds, only two of the four vectors are stored. Together with the matchings, this deﬁnes discrete symmetric frame ﬁelds uniquely. Deﬁnition 6 A matching on a discrete manifold M is a map r : {edges ei j | Ti ∩ T j = ei j } → {0, 1, 2, 3}, which determines the matching ri j for two adjacent triangles Ti and T j . We denote the space of all those maps by RM . 2.4. Vector ﬁelds on covering spaces In this section, we show how frame ﬁelds can be described with vector ﬁelds on a covering surface. This result allows us to apply the classical theory for vector ﬁelds to frame ﬁelds. A frame ﬁeld Xi,k on M with matchings r canonically lifts to a vector ﬁeld X on the covering: in each chart Ui , lift Xi,k to a vector ﬁeld X on a trivial 4-sheeted covering Ui′ of Ui l as follows: For p ∈ τU (U), set X(p) = Xi,l (πi (p)) (Figure 5, bottom left). The result is a globally deﬁned vector ﬁeld X on the covering M ′ induced by the matchings r. When the coverings of the charts are patched together as described in Def. 3, X becomes a well deﬁned vector ﬁeld on M ′ , since the layers of the covering are connected in the same way as the vector ﬁelds permute when another chart is chosen. Deﬁnition 7 Let M be a manifold with matchings r and M ′ the induced covering. A frame ﬁeld lifted to a vector ﬁeld X on M ′ is called a covering ﬁeld of M.
c The Eurographics Association and Blackwell Publishing 2007.

ˆ Given a function ϕ′ ∈ Sr (M ′ ), its derivative ∇ϕ′ is a piecewise constant and curl free vector ﬁeld on M ′ and each curl free vector ﬁeld can be expressed as graˆ ˆ dient ﬁeld of a function in Sr (M ′ ), thus ∇Sr (M ′ ) = {curl free vector ﬁelds on M ′ }, see [PP03]. Parameterization function. A symmetric covering function can be projected to a function ϕ : M → R2 by taking the values of layer 0 and 1 in each point p ∈ Ui :
1 0 ϕi (p) = (ϕ′ (τUi (p)), ϕ′ (τUi (p)))T =: (ui (p), vi (p))T . (6)

The components of this function ϕi at the intersection of two adjacent maps Ui , U j then meet: (ui , vi )T = ϕi ◦ ϕ−1 (u j , v j )T = J −ri j (u j , v j )T − ti j . j with the constant translation vector ti j ∈ R2 . If ϕ′ is continuous up to jumps by integer values, all transition functions of ϕi are grid automorphisms (see Equation 2) and therefore, the parameter lines are globally continuous. Thus, we seek for a function in the space Sr (M ′ ) := {u ∈ Sr (M ′ ) | ∀ adjacent Ti , T j : ti j ∈ Z2 }. Given a parameterization function ϕ′ ∈ Sr (M ′ ), the function values on any map Ui may be translated by an arbitrary integer offset without changing the gradient ﬁeld or the ﬁnal parameter lines. Thus, we assume w.l.o.g. that all ti j = 0 except for edges which lie on the given cut graph G. (7)

Kälberer, Nieser, Polthier / QuadCover - Surface Parameterization using Branched Coverings

Discretization. In our algorithm, the covering surface is not explicitly computed. It is only represented by the matchings r. Symmetric scalar functions on the covering are stored as the vector ϕ|T (p) = (uT,p , vT,p ) from equation (6) in each triangle T at each of its three corners p. A cut graph can be obtained as the boundary of a spanning disk of M ′ , see Figure 8, middle. It is not of interest for the algorithm, which cut graph is chosen or if it cuts the surface into one or more connected components. The resulting parameter lines are independent of this choice except for slightly different rounding results in Section 4.1. ˆ Constructing a basis of Sr (M ′ ). We now construct a basis of Sr (M ′ ) which describes all scalar functions and possible choices of the translation values ti j . At edges of the cut graph G, ti j cannot be chosen arbitrarily. At each vertex of M ′ , the (oriented) sum of ti j at outgoing edges is always 0. Let Sh (M ′ ) be the space of all continuous piecewise linear functions on M ′ with basis functions Φi and let P = {γi ⊂ G | i ∈ {0, . . . , n p −1}} be a set of n p cut paths with γ∈P γ = G. For a genus g surface without boundaries, these n p = 2g paths generate the homology group of M. If the surface has nb > 0 boundary components, we additionally need paths, which connect the boundaries, thus we have n p = 2g+nb −1 paths. ˆ ˆ For each path γi , let Φi ∈ Sr (M ′ ) be the piecewise linear function on M, which is 1 on the right side at all vertices along the path, 0 on the left side and 0 at all other vertices of the surface. This is a discontinuous function on M, however ˆ ∇Φi is a curl free vector ﬁeld. ˆ ˆ Theorem 1 The functions {Φi }∪{Φ j } are a basis of Sr (M ′ ). Proof For each path γ j ∈ P, the gradient ﬁeld of the corresponding basis function ∇Φ j has periods different from ˆ ˙ 0, i. e. the path integral δ ∇Φi , δ ds along a path δ on M which crosses γ j at exactly one point p ∈ δi is 1 or −1, depending on the orientation of δ and γ j . Since the new basis ˆ ˆ functions Φi are linear independent, the space Sr (M ′ ) is of dimension nv + n p = nv + 2g + max(b − 1, 0). This is exactly the dimension of the space of curl ∗ free vector ﬁelds. Further, the gradients of all functions in Sh are curl ∗ free, thus ˆ ∇Sh = {curl ∗ free ﬁelds}. This is exactly the space of harmonic vector ﬁelds plus gradient ﬁelds on M ′ . ˆ Deﬁnition 9 For a given function f ∈ Sr (M ′ ), let λi ( f ) and µ j ( f ) be the coefﬁcients of f when written as linear combiˆ nation of basis vectors, that is, f = ∑i λi Φi + ∑ j µ j Φ j . We order the vertices of the covering, such that successive vertices v2i , v2i+1 are associated to another, i.e. π(v2i ) = π(v2i+1 ) and they differ by a layer shift of 2. For the algorithm, we also require that the paths are symmetric on the covering, i.e., for each path γ2 j the path γ2 j+1 differs only by a layer shift of 2. How to ﬁnd cut paths with this property ˆ is described in Section 4.4. Thus, a function f ∈ Sr (M ′ ) is a

symmetric covering function if and only if for all i λ2i = −λ2i+1 , µ2 j = −µ2 j+1 . (8)

Theorem 2 Let p be a branch point with layer shift ls(p) = 1 or ls(p) = 3 (according to Def. 4). Then the value of any symmetric scalar function (u, v) ∈ Sr (M ′ ) at p is either a grid point (u(p), v(p)) ∈ Z2 or a midpoint of a grid cell (u(p) + 1/2, v(p) + 1/2) ∈ Z2 . If ls(p) = 2, then it is a grid point of grid size 1/2: 2(u(p), v(p)) ∈ Z2 . Let p be a vertex with ls(p) = 2. Then the value of any symmetric scalar function (u, v) ∈ Sh (M ′ ) at p is a grid point of grid size 1/2: 2(u(p), v(p)) ∈ Z2 . Proof Let T0 , . . . , Tn be the triangles incident to p in counterclockwise order. Looking at the values f = (u, v) at vertex p in these triangles, they satisfy: (uT1 ,v , vT1 ,v )T ∈ J −r01 (uT1 ,v , vT1 ,v )T + Z2 (uT1 ,v , vT1 ,v )T ∈ J −r01 −r12 (uT1 ,v , vT1 ,v )T + Z2 . . . (uT1 ,v , vT1 ,v )T ∈ J −ls(v) (uT1 ,v , vT1 ,v )T + Z2 ⇒ (uT1 ,v , vT1 ,v )T ∈ (Id − J −ls(v) )−1 Z2 Calculating the inverse matrix and applying it to all integer grid points leads to the claimed proposition. In particular, this theorem holds for the resulting parameterization map, since it is a symmetric scalar function on M ′ . It follows, that all branch points get mapped to either a grid point or to the middle of a grid cell. Branch points with layer shift 2 may also lie at the midpoint of an edge. Remark. If a branch point is mapped to the middle of a grid cell, this cell may become a triangle, pentagon or a polygon of higher degree. If the parameterization should generate a pure quad mesh, all branch points should be located at grid points. According to Theorem 2, this can be assured by parameterizing the surface half as ﬁne (multiply all input vectors with 1/2) and multiply the resulting parameterization function ϕ with 2. 3. Algorithm Choice of input frame ﬁeld. The user input to our method is a matching r ∈ RM and a symmetric frame ﬁeld Ki,k , or, equivalently, a symmetric covering ﬁeld on a simplicial surface. This ﬁeld acts as a guidance ﬁeld for the ﬁnal parameterization. There are different ways of constructing such an input ﬁeld. It is up to the user, if he speciﬁes the matchings r or if he just provides two vectors per triangle (and their negatives). In the latter case, matchings can be automatically generated by associating the four vectors in each triangle to those in adjacent triangles. It is reasonable to identify the vectors with the smallest angle to each other in order to get straight parameter lines.
c The Eurographics Association and Blackwell Publishing 2007.

Kälberer, Nieser, Polthier / QuadCover - Surface Parameterization using Branched Coverings

3. Deﬁne the topology of the covering surface by calculating matchings at the edges (required). 4. Optimize the topological structure, see Sect. 4.2 (opt.). Main steps ˜ 1. Find a potential function ϕ, whose gradient ﬁeld optimally aligns with the given input frames. 2. Add the harmonic scalar function ψ with minimal L2 ˜ norm such that the parameterization ϕ = ϕ + ψ is globally closed. Steps 1 and 2 are detailed in the following section. 4. Implementation details Computing the potential function. The ﬁnal parameterization should align with the given input ﬁeld as well as possi˜ ble, i. e., the parameterization ϕ should minimize the energy E(ϕ) =
M′

Figure 7: The Costa surface parameterized with different input ﬁelds. Middle: Input frames align with the edges of the input mesh (left). Right: Input frames align with principal curvature directions. Constructing from curvatures. In most cases, we used the principal curvature directions as input. In general, it is not possible to assemble the principal curvature directions globally in four separate vector ﬁelds. But locally in each chart and away from umbilics, one can deﬁne four vector ﬁelds whose vectors have unit length and point into the four principal curvature directions, sorted in a counterclockwise order. In regions where two charts Ui , U j overlap, these vector ﬁelds then only differ by a cyclic permutation of the four vectors. This shift is the matching −ri j . The resulting frame ﬁeld could also be extended to the umbilic regions of the surface, where no principal curvature directions are deﬁned. In general, this is not possible without getting some branch points in the umbilic region. Furthermore, the calculation of principal curvature directions in umbilic regions leads to vectors pointing in arbitrary directions in practice. Thus, we use a preprocessing step to smooth the given frame ﬁeld in umbilic regions, such that they align with the curvature directions in their neighborhood (see Section 4.3). Discrete principal curvature directions and values can be calculated as proposed in [CSM03] or [HP04]. Note that we deal with curvatures given on triangles, not on vertices. 3.1. Algorithm overview The algorithm is split into two parts, the preprocessing part and the main algorithm. In the preprocessing part, the guidance frame ﬁeld for the parameter lines is generated. The methods applied there control the construction and improvement of the frame ﬁeld. In the main part, a global parameterization function will be generated. First, the given input frame ﬁeld is approximated by the gradient of a scalar function. Second, the parameterization will be adapted to make the parameter lines globally continuous. The output is the function ϕ : M → R2 , which can be used as a texture map to visualize the parameter grid or for quad mesh generation. Preprocessing steps 1. Calculate principal curvature directions K (required). 2. Smooth principal curvature ﬁeld, see Sect. 4.3 (opt.).
c The Eurographics Association and Blackwell Publishing 2007.

∇ϕ − K

2

dA

(9)

ˆ in the space ϕ ∈ Sr (M ′ ), with ﬁxed matchings r. Recall, that K is a symmetric covering ﬁeld and the covering surface is symmetric due to a cyclic permutation of the layers by 2. Since the energy has a unique minimum, the ˜ solution ϕ is also symmetric. In the smooth setting, this algorithm can also be formulated using covering ﬁelds instead of the scalar function ϕ. The Hodge-Helmholtz decomposition of a vector ﬁeld K on a manifold M ′ is a unique description of K as K = PK +CK + HK (10)

with a gradient ﬁeld PK , a cogradient ﬁeld CK and a harmonic ﬁeld HK . Discarding the second term leads to a curl ˜ free ﬁeld X := PK + HK whose integral is the minimizer of Energy (9). For the Hodge decomposition of discrete vector ﬁelds see [PP03]. The Hodge decomposition does not need a cut graph of the surface, so the gradient of the optimal solution ∇ϕ in Equation (9) must also be independent of the cut graph. 4.1. Global continuity ˜ If we took the solution ϕ from the previous paragraph as parameterization map, the parameter lines would not be continuous everywhere on the surface. They may have a mismatch ˜ at the cut graph G. With the representation of ϕ with basis functions (see Def. 9), the parameter lines are globally con˜ tinuous if and only if all µ j (ϕ) ∈ Z. In order to adapt ϕ to fulﬁll the global continuity con˜ dition, we add another scalar covering function ψ to ϕ such ˜ that ϕ := ϕ + ψ satisﬁes µ j (ϕ) ∈ Z. We determine ψ by spec˜ ˜ ifying the coefﬁcients µ j (ψ) := [µ j (ϕ)] − µ j (ϕ), and calculate all other coefﬁcients such that △ψ = 0. That means,

Kälberer, Nieser, Polthier / QuadCover - Surface Parameterization using Branched Coverings

heuristic with just rounding the values µ j as described in this section is in general not optimal but leads to good results.

4.2. Branch point optimization As branch points often reduce the straightness of parameter lines, we employ a simple heuristic to ﬁnd nearby branch points, whose layer shifts add up to zero. Those points can be merged by changing the matching at the edges in-between, resulting in a locally trivial covering. Let Cb be a cost function on vertices, which is 1 for branch points and 0 for all other vertices, thus Cb penalizes the occurrence of branchings. Let another cost function Ci j = ∠(Xi,k , X j,(k+ri j ) mod 4 ) on the edges of the mesh represent the parallelism between vectors in the incident triangles Ti , T j . If we change the matching consistently along an edge path between two vertices, the layer shift of all but the two end points of the path remain constant. If one of the endpoints is a branch point, we can always change the matching along that path so the layer shift for one of the vertices becomes 0, possibly for both of them. We use a greedy search strategy that ﬁnds paths between singularities, such that a change of the matching along the whole path reduces the total cost C = λCb + ∑i j Ci j . Here, λ weights branch point reduction vs. vector ﬁeld straightness.

Figure 8: Parameterized minimal surfaces: Trinoid (left), Schwarz P-surface with its cut graph, and the Hyperboloid parameterized using non-orthogonal frames. that ∇ψ is required to be a harmonic vector ﬁeld, because these are the smallest vector ﬁelds with given periods in L2 norm, so the distortion of the parameterization will be minimal. The Laplace equation can be written as a linear system of equations for the unknown coefﬁcients λi (ϕ) and solved efﬁciently. Generating quads. If the function values at all branch points are integers, and all triangles are positively oriented in R2 , then the parameterization produces only quads. According to Theorem 2, if ϕ ∈ Sr (M ′ ), then it may happen, that a branch point lies in the middle of a grid cell. As a result, the parameterization would contain triangles or other polygons. A pure quad grid is guaranteed if µ j (ϕ) ∈ 2Z. (11)

Thus, rounding all µ j (ϕ) coefﬁcients to values in 2Z instead of Z leads to a parameterization consisting of quads only. The rounding of the coefﬁcients depends on whether a pure quad grid is required. Optimal solution. The minimal energy solution from Section 4 is not necessarily optimal, since the values µ j (ϕ) might not be rounded optimally. This is the only part in the algorithm, where the parameterization results depend on the cut graph. The exact solution of the optimization problem described below would lead to parameter lines which are independent of the cut graph. ˆ Let (h j ) j=1...#paths ∈ Sr (M ′ ) be a basis of the harmonic functions on M ′ , with µk (h j ) = 1, if k = j and µk (h j ) = 0, if k = j. Let H := ∑ j c j h j , c j ∈ R according to Def. 9. Considering Condition (8), ﬁnding the symmetric harmonic ﬁeld H with minimal L2 norm is equivalent to ﬁnding the λi , which minimize vAvT , such that λ j + q j (X) ∈ Z, with v = (λ0 , −λ0 . . . , λn , −λn ), Ai j =
M

4.3. Aligning the frame ﬁelds To smooth the frame ﬁeld, and to extend the principal curvature directions into umbilic regions, we adapted the smoothing method in [HZ00]. The frame Xi in each triangle Ti is rotated by an angle αi , such that adjacent frames align best with respect to the following smoothing energy. The energy operates on the angles between frames of pairs of adjacent elements. Esmooth = area(Ti ) + area(T j ) cos 4(θi j + αi − α j ) , 3 i> j

∑

(12)

hi , h j dA.

where θi j is the initial angle between the frames of triangles i and j. Measuring angles between frames is not unique, since there are four vectors in each frame. However, since vectors resulting from principal curvature directions differ by multiples of π , this is irrelevant, due to the periodicity of the 2 cosine. The above energy will align all frames with each other, but will not retain the directions of principal curvature. We desire a balanced smoothing step, which ﬁxes angles where the curvature directions are very pronounced, but which also aligns frames in umbilic areas to the ﬁxed frames. For that purpose, we blend the smoothing energy with an alignment
c The Eurographics Association and Blackwell Publishing 2007.

This is a quadratic discrete optimization problem. The exact optimum is hard to obtain. For the generation of the matrix A, one has to compute a set of covering ﬁelds, which are a basis of the harmonic ﬁelds (consisting of 2 · genus(M)) + #singularities many minimization problems). Then, the quadratic integer problem has to be solved. Our

Kälberer, Nieser, Polthier / QuadCover - Surface Parameterization using Branched Coverings

Figure 9: Parameterization of the hand model. Branch points are marked red. term, which measures the distance to the original ﬁeld. E = λEsmooth + (1 − λ)Ealign , Ealign = ∑
i

where Figure 10: Comparison of the remeshed hand model with [TACSD06] (top). Bottom: constructed with QuadCover. The hand model is courtesy of Pierre Alliez. Except from setting preprocessing parameters, no interaction was involved. If there is no such branch point, one could also take any other point on the manifold, but has to catch some special cases in the following construction process. In practice, almost all meshes have branch points of layer shift 1. Now, for each branch point pi = p0 , compute a cycle γn+i starting at p0 , going around pi and ending at p0 again. Each of these paths γi can now be lifted to 4 paths γi , j = {0, 1, 2, 3} on M ′ . If some of the lifted paths are not closed on M ′ (since start and end point are on different layers), extend them by walking around the root vertex p0 until the path gets closed (walking around the root vertex once performs a layer shift of 1). The collection of paths γ′ obtained by this construction cuts the covering manifold open. 5. Results and conclusion Our algorithm delivered pleasing parameterizations on a wide range of models, as shown in Figures 1, 9, 11, and 10. Comparisons to state-of-the-art show that QuadCover
[RLL∗ 06] [TACSD06] [DBG∗ 06] QuadCover 6355 6576 7202 6535 314 34 26 37 25.0% 28.3% 30.8% 18.2% 10.7% 12.6% 7.8% 14.8%
j

area(Ti ) ωi α2 . i

The weights ωi indicate the stability of the principal curvature directions in the current triangle. As a heuristic, we use ωi := |κ1 − κ2 |/ κ2 + κ2 1 2 and set ωi = 0 if κ2 + κ2 = 0. Here, κ1 and κ2 are the prin1 2 cipal curvature values in the current triangle. Minimization of E then yields a smooth vector ﬁeld which is roughly aligned to the features of the mesh. The user-set factor λ determines if there is more emphasis on smoothing (λ ≈ 1) or on principal curvature alignment (λ ≈ 0). 4.4. Generation of symmetric cut paths This section deals with the problem of ﬁnding paths γ′ on i a 4-sheeted symmetric covering π : M ′ → M of a given discrete manifold M, such that M ′ \ {γ′ } is cut open to a topoi logical disk. This is done by ﬁrst cutting M open and then lifting the paths to the covering. By comparing the Euler characteristic of M and M ′ , one notices that the number of paths p′ which are necessary on M ′ can be calculated from the number of paths p on M: p′ = 4p − 3. Our method constructs 4p paths on M ′, thus we get 3 paths more than needed, so the covering gets cut into 4 simply connected components. First, construct some paths γi on M, which cut M open. If the surface has boundaries, there are n = 2g + numBoundaries − 1 paths necessary. Choose one branch point of layer shift 1 as origin p0 of all paths, so all paths begin and end at p0 . This could be done by extracting all circles of a cut graph of M.
c The Eurographics Association and Blackwell Publishing 2007.

vertices irreg. vert. RSD edge RSD angle

Table 1: The number of total and irregular vertices of the models shown in Figure 11, as well as the relative standard deviation of their edge lengths and vertex angles.

Kälberer, Nieser, Polthier / QuadCover - Surface Parameterization using Branched Coverings

References
[ACSD∗ 03] A LLIEZ P., C OHEN -S TEINER D., D EVILLERS O., L ÉVY B., D ESBRUN M.: Anisotropic polygonal remeshing. ACM Trans. on Graph. (2003), 485–493. [BMRJ04] B OIER -M ARTIN I., RUSHMEIER H., J IN J.: Parameterization of triangle meshes over quadrilateral domains. In Proc. Eurographics/ACM Symp. on Geom. Proc. (2004), pp. 193–203. [CSM03] C OHEN -S TEINER D., M ORVAN J.-M.: Restricted delaunay triangulations and normal cycle. In Proc. of Symp. on Comp. Geom. (2003), ACM Press, pp. 312–321. [DBG∗ 06] D ONG S., B REMER P.-T., G ARLAND M., PASCUCCI V., H ART J.: Spectral surface quadrangulation. ACM SIGGRAPH (2006). [DKG05] D ONG S., K IRCHER S., G ARLAND M.: Harmonic functions for quadrilateral remeshing of arbitrary manifolds. Comp. Aided Design 22, 4 (2005), 392–423. [FK80] FARKAS H. M., K RA I.: Riemann Surfaces. Springer Verlag, 1980.

Figure 11: Comparison of remeshing results of the Stanford bunny. Models were produced by [RLL∗ 06] and [TACSD06] (top), [DBG∗ 06] and our algorithm (bottom). The upper histogram next to each model shows the distribution of edge lengths, the lower histogram represents angle distribution.

[Ful95] F ULTON W.: Algebraic Topology, A ﬁrst course. Springer Verlag, 1995. [GY03] G U X., YAU S.-T.: Global conformal surface parameterization. In Symp. on Geom. Proc. (2003), pp. 127–137. [HP04] H ILDEBRANDT K., P OLTHIER K.: Anisotropic ﬁltering of non-linear surface features. Computer Graphics Forum 23, 3 (2004), 391–400. [HZ00] H ERTZMANN A., Z ORIN D.: Illustrating smooth surfaces. In ACM SIGGRAPH (2000), pp. 517–526. [Jos02] J OST J.: Compact Riemann Surfaces. Springer, 2002. [KSS06] K HAREVYCH L., S PRINGBORN B., S CHRÖDER P.: Discrete conformal mappings via circle patterns. ACM Transactions on Graphics 25, 2 (2006). [LRL06] L I W.-C., R AY N., L ÉVY B.: Automatic and interactive mesh to T-spline conversion. In Proc. Eurographics/ACM Symp. on Geom. Proc. (2006), pp. 191–200. [MK04] M ARINOV M., KOBBELT L.: Direct anisotropic quaddominant remeshing. In Proc. of the 12th Paciﬁc Conf. on Comp. Graph. and Appl. (2004), pp. 207–216. [MK06] M ARINOV M., KOBBELT L.: A robust two-step procedure for quad-dominant remeshing. Computer Graphics Forum ˝ 25, 3 (2006), 537U–546. [PP03] P OLTHIER K., P REUSS E.: Identifying vector ﬁeld singularities using a discrete Hodge decomposition. In Visualization and Mathematics III. Springer Verlag, 2003, pp. 113–134. [RLL∗ 06] R AY N., L I W. C., L ÉVY B., S HEFFER A., A LLIEZ P.: Periodic global parameterization. ACM Trans. Graph. 25, 4 (2006), 1460–1485. [RVLL06] R AY N., VALLET B., L I W.-C., L ÉVY B.: Nsymmetry direction ﬁelds on surfaces of arbitrary genus. Tech. rep., January 2006. [TACSD06] T ONG Y., A LLIEZ P., C OHEN -S TEINER D., D ES BRUN M.: Designing quadrangulations with discrete harmonic forms. In Proc. Eurographics/ACM Symp. on Geom. Proc. (2006), pp. 201–210.

produces very competitive results, see Fig. 11. As the ﬁgure illustrates, we roughly share the curvature alignment of [RLL∗ 06], but managed to drastically reduce the occurrence of irregular points, and we restricted ourselves to quadrilaterals. In contrast to the methods of [TACSD06] and [DBG∗ 06], our algorithm is suited to handle arbitrary locations of branch points, as we do not restrict the branch points to be the corners of some coarse meta mesh. Table 1 shows that QuadCover exhibits the smallest edge length variation, at the cost of higher angular deviation. Discarding the curvature alignment term during smoothing signiﬁcantly reduces angular deviation, but generally, more wrinkles in the ﬁnal quad mesh are introduced where parameter lines don’t follow high curvature. We have identiﬁed frame ﬁelds with vector ﬁelds on branched coverings. This theoretical foundation reduces the parameterization problem to well studied problems of vector ﬁeld decompositions, once the set of branch points is ﬁxed. We hope that this simplifying concept will give rise to further fruitful ideas for surface parameterization and remeshing. Acknowledgments We thank Max Wardetzky for valuable discussions on covering spaces. We thank Pierre Alliez, Timo Bremer, John Hart, Leif Kobbelt, and Bruno Lévy for generously supporting us with comparison material.

c The Eurographics Association and Blackwell Publishing 2007.

